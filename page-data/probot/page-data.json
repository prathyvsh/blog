{"componentChunkName":"component---src-templates-blog-post-js","path":"/probot/","result":{"data":{"site":{"id":"Site","siteMetadata":{"title":"dayDreams ++","author":"Athul Cyriac Ajay"}},"markdownRemark":{"id":"331f45c4-8a38-5ffe-983f-df72085460cf","excerpt":"GitHub Apps with Probot Ever see in any issues or Pull Request in GitHub where a bot comments on the PR/Issue or adds labels to the PR/Issue? If you have, they‚Ä¶","html":"<h3>GitHub Apps with Probot</h3>\n<p>Ever see in any issues or Pull Request in GitHub where a bot comments on the PR/Issue or adds labels to the PR/Issue? If you have, they are generally termed as GitHub apps and can be made relatively easily.<br>\nMost of these apps are written in JavaScript (Node.js) using <strong>Probot</strong>, a framework for building apps for GitHub. Probot is written in Typescript, a superset of JavaScript. You can find more about on their <a href=\"https://probot.github.io\">website</a>. </p>\n<hr>\n<p> Here we‚Äôll make a <strong>Simple Issue and Pull Request commenter</strong> bot which is made and deployed on Glitch.</p>\n<h6>Prerequisites</h6>\n<ul>\n<li>GitHub account</li>\n<li>An account on Glitch using GitHub</li>\n<li>\n<p>Basic JavaScript knowledge like variables and strings and functions</p>\n<h4>Making our App on Glitch</h4>\n<p>Glitch is a free online code-editing platform. It sets up our environment with all the necessary packages and stuff. All you need to do is click this buttonüëá and you‚Äôll get a full working environment for your ‚ÄúRemixing‚Äù.</p>\n<!-- Remix Button -->\n<a href=\"https://glitch.com/edit/#!/remix/twilight-marquis\">\n<img src=\"https://cdn.glitch.com/2bdfb3f8-05ef-4035-a06e-2043962a3a13%2Fremix%402x.png?1513093958726\" alt=\"remix this\" height=\"33\">\n</a>\n</li>\n</ul>\n<p>What Probot does is that it abstracts the authentication system that all GitHub Apps have to follow - letting you focus on writing API requests without worrying about API tokens or permissions.<br>\nProbot ships with an example of setting up an issue commentor bot in <code class=\"language-text\">index.js</code>.\nWe‚Äôll edit the <code class=\"language-text\">index.js</code> to the following </p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">//index.js</span>\nmodule<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">app</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n <span class=\"token comment\">// Your code here</span>\n app<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Yay, the app was loaded!'</span><span class=\"token punctuation\">)</span>\n app<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'issues.opened'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token parameter\">context</span> <span class=\"token operator\">=></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n   <span class=\"token keyword\">const</span> issue<span class=\"token operator\">=</span>context<span class=\"token punctuation\">.</span>payload<span class=\"token punctuation\">.</span>issue <span class=\"token comment\">//getting issue details</span>\n   <span class=\"token keyword\">const</span> user<span class=\"token operator\">=</span>issue<span class=\"token punctuation\">.</span>login<span class=\"token punctuation\">.</span>user <span class=\"token comment\">//Getting the username</span>\n   <span class=\"token keyword\">const</span> message<span class=\"token operator\">=</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Thanks @</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>user<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> for opening this issue!:tada:\n   You are awesome..</span><span class=\"token template-punctuation string\">`</span></span>\n   <span class=\"token keyword\">const</span> params <span class=\"token operator\">=</span> context<span class=\"token punctuation\">.</span><span class=\"token function\">issue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> message <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n   <span class=\"token keyword\">return</span> context<span class=\"token punctuation\">.</span>github<span class=\"token punctuation\">.</span>issues<span class=\"token punctuation\">.</span><span class=\"token function\">createComment</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\n <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The above code is for a bot which comments on new issues. It mentions the user too. The <em>‚ÄúRobotic‚Äù</em> characteristics start from the 4th line starting with <code class=\"language-text\">app.on</code> function the first argument passed is the action which the bot listens to. These are <strong>webhook</strong> events of GitHub - you can learn more about them from the <a href=\"https://developer.github.com/webhooks/\">Webhook Documentation</a>.<br>\nProbot uses Node‚Äôs <code class=\"language-text\">async/await</code> API for returning the data. We used the <em>`</em> character to enclose the string/comment body because we won‚Äôt need to use escape characters and we can also interpolate <a href=\"https://flaviocopes.com/javascript-template-literals/\">Template Literals</a>.         </p>\n<p>Now we need to check if our app is working or not, we can do this <strong>clicking</strong> on a ‚Äúsunglasses‚Äù button on Glitch which should look like this <br><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 264px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/54839fedc2081ff900b21088dff02fe2/e61aa/glitch_show.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.84848484848485%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA+wAAAPsAHpfpy9AAABAklEQVQY021QMctGUBR+f4DFKKN/wOgfGK0mpfwADAazYjL4CUopG6ONwSCDMshgMEnKgML3fud1pe+r96l77unc8zz3POf1vvBz4f0fX4vPE8QXnOM4IE7TFEXRtm3nee77jopVVaVp+nQDzgs3GV3AMU0zjuOnA2JRFJqmNU3zkEERJaB+/1yWJcdxhmFA3nWdqqqu62ZZpuv6OI6IieTyPE+SpG3bMAw/5HVdaZpmGEaWZcuyeJ4nSVIURUEQ5nl+TCFAHgSB4zjDMHzIy7KwLIvjOEVRdV0rioJhGEEQnuc94/0FGESi99jgTZIk3/ch7/se+LZtw0Rfl4y2hVz8AqN2YzkJF+KFAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Glitch Show\"\n        title=\"Glitch Show\"\n        src=\"/blog/static/54839fedc2081ff900b21088dff02fe2/e61aa/glitch_show.png\"\n        srcset=\"/blog/static/54839fedc2081ff900b21088dff02fe2/12f09/glitch_show.png 148w,\n/blog/static/54839fedc2081ff900b21088dff02fe2/e61aa/glitch_show.png 264w\"\n        sizes=\"(max-width: 264px) 100vw, 264px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>    </p>\n<p>Then You‚Äôll see a Page like this <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/0e82e42d2770124663de11c05baaeaa4/47311/wp.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 165.1851851851852%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAhABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAECAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB97GsJ1C5UUEBQf/EABsQAAEEAwAAAAAAAAAAAAAAAAABEBEgAhIh/9oACAEBAAEFAjGWXhsy0mv/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AV//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AV//xAAZEAACAwEAAAAAAAAAAAAAAAAAMQERIDD/2gAIAQEABj8CJvKFw//EAB4QAQACAQQDAAAAAAAAAAAAAAEAERAgITFBcaHR/9oACAEBAAE/IY35dsNFgQShR7+Y5dpRg13Aaf/aAAwDAQACAAMAAAAQjMSw8A//xAAVEQEBAAAAAAAAAAAAAAAAAAARIP/aAAgBAwEBPxAr/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPxBf/8QAHhAAAgICAgMAAAAAAAAAAAAAAREAMRBRIYFhobH/2gAIAQEAAT8QhJIACYDhTYLfSEHh52n2EIR4cG1ACj9QVS8QLEu1EAK0zccOf//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Page\"\n        title=\"Page\"\n        src=\"/blog/static/0e82e42d2770124663de11c05baaeaa4/1c72d/wp.jpg\"\n        srcset=\"/blog/static/0e82e42d2770124663de11c05baaeaa4/a80bd/wp.jpg 148w,\n/blog/static/0e82e42d2770124663de11c05baaeaa4/1c91a/wp.jpg 295w,\n/blog/static/0e82e42d2770124663de11c05baaeaa4/1c72d/wp.jpg 590w,\n/blog/static/0e82e42d2770124663de11c05baaeaa4/a8a14/wp.jpg 885w,\n/blog/static/0e82e42d2770124663de11c05baaeaa4/47311/wp.jpg 1080w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\nClick the <strong>Register GitHub App</strong> button and provide a name and install it in a repository.</p>\n<blockquote>\n<p>Tip: Create a new private repository because we‚Äôll be making a lot of noise for the testing   </p>\n</blockquote>\n<p> Now, if you check the <code class=\"language-text\">.env</code>  file you‚Äôll see the variable values auto-filled with the necessary data. Glitch automatically deploys our app and our app will be listening to the webhooks to be received.</p>\n<blockquote>\n<p>Test the app by making a new issue in a test repo on GitHub.   </p>\n</blockquote>\n<p> It works right?<br>\nCongratulations üéâüéâ You just made yourself a GitHub Appüëåüëå </p>\n<h5>Redelivering Webhook‚§¥Ô∏è</h5>\n<p>We can view all the webhooks of any event triggered by the Repository and we can redeliver them by going to <strong>Settings->Developer Settings->GitHub Apps->‚ÄúYour app name‚Äù->Advanced Tab</strong> in your profile.</p>\n<h4>Commenting on PRs</h4>\n<p>We need to add an extra permission for our App to comment on PRs, we can provide that by going to <code class=\"language-text\">Settings-&gt;Develope Settings-&gt;&lt;Your_app_name&gt; -&gt; Permissions and Events -&gt; Pull Requests</code> Provide the read and Write Access.<br>\nNow we need to edit the <code class=\"language-text\">index.js</code> to add Support for Pull Request before the last <code class=\"language-text\">}</code></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">//index.js</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'pull_request.opened'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token parameter\">context</span> <span class=\"token operator\">=></span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> pr <span class=\"token operator\">=</span> context<span class=\"token punctuation\">.</span>payload<span class=\"token punctuation\">.</span>pull_request\n    <span class=\"token keyword\">const</span> user <span class=\"token operator\">=</span> pr<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">.</span>login <span class=\"token comment\">//Collecting Details of the person who created the PR</span>\n     <span class=\"token keyword\">const</span> msg<span class=\"token operator\">=</span>context<span class=\"token punctuation\">.</span><span class=\"token function\">issue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>body<span class=\"token operator\">:</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Hey @</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>user<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> :wave: Thanks for the PR !!! You are Awesome.</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n     <span class=\"token keyword\">return</span> context<span class=\"token punctuation\">.</span>github<span class=\"token punctuation\">.</span>issues<span class=\"token punctuation\">.</span><span class=\"token function\">createComment</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p> Here we add a new <em>‚Äúrobotic‚Äù</em> characteristic by passing a webhook action called <em>pull_request.opened</em>. Now our app listens for PR webhook and once received it emits the <code class=\"language-text\">context.issue({body})</code> to GitHub. You can see that we are still passing the body to the <em>createComment</em> function. This is because PRs are considered as another type of Issues in GitHub.\nFor testing if this works, make a new PR and check if the bot comments on that yes.</p>\n<hr>\n<p>Congratulations on making a GitHub app. Since it is on Glitch we can install this in any repository and it will work any time too. </p>\n<blockquote>\n<p>You can customise the comments with Images and Gifs but keep in mind that the comments render markdown.\nYou can always import these files to a GitHub repository through Glitch.<br>\nNow go forth, explore and make some exciting GitHub apps,‚ù§Ô∏è‚ù§Ô∏è</p>\n</blockquote>\n<h5>Thanks to</h5>\n<ul>\n<li><a href=\"https://github.com/JasonEtco\">Jason Etcovich</a>, for Proofreading this ‚ù§Ô∏è</li>\n<li><a href=\"https://github.com/haxzie\">Musthaq Ahamad</a>, for teaching me how to make GitHub Apps</li>\n</ul>","frontmatter":{"title":"Making GitHub apps with Probot","date":"July 04, 2019","description":"Making GitHub apps easier with Probot and Node.js"}}},"pageContext":{"slug":"/probot/","previous":{"fields":{"slug":"/Automate-stuff/"},"frontmatter":{"title":"Shell Scripting to Automation"}},"next":{"fields":{"slug":"/My-Setup/"},"frontmatter":{"title":"My System Setup"}}}}}